<!DOCTYPE HTML>
<html>
  <head>
    <body>
    <div class="dropdown">
      <button onclick="myFunction()" class="dropbtn">Dropdown</button>
      <div id="myDropdown" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
        <a onclick="graph(0)">Black Beans</a>
        <a onclick="graph(1)">Lettuce</a>
        <a onclick="graph(2)">Tomato</a>
        <a onclick="graph(3)">Tortilla</a>
        <a onclick="graph(4)">Shredded Cheddar Cheese</a>
      </div>
    </div>
    <button onclick="graph()">Submit</button>
    <div id="ingredients">
      <table id="ingredient-table"></table>
    </div>
    <div id="calories"></div>
    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
      <div id="nutrition">
      <table id="nutrition-table"></table>
    </div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  </body>
<script>

//sat. fat, sodium, fiber, added sugar, vit. D, calcium, iron, potassium
var nutritionInfo = [0, 0, 0, 0, 0, 0, 0, 0];
//g, mg, g, g, mcg, mg, mg, mg
var dailyRec = [20, 2300, 28, 50, 20, 1300, 18, 4700];

var calories = []; 
var fat = []; 
var sodium = [];
var fiber = []; 
var sugar = []; 
var vitd = []; 
var calcium = []; 
var iron = []; 
var potassium = []; 
var ingredients = ["Black Beans", "Lettuce", "Tomato", "Tortilla", "Shredded Cheddar Cheese"];
var selected = [];
var quantities = [];


function removeSlot(val) {
  selected.splice(val,1);
  quantities.splice(val,1);
  calories.splice(val,1);
  nutritionInfo[0].splice(val,1);
  nutritionInfo[1].splice(val,1);
  nutritionInfo[2].splice(val,1);
  nutritionInfo[3].splice(val,1);
  nutritionInfo[4].splice(val,1);
  nutritionInfo[5].splice(val,1);
  nutritionInfo[6].splice(val,1);
  nutritionInfo[7].splice(val,1);
  graph();
}

function servings(val) {
  quantities[val] = document.getElementById("servings-" + val).value;
  graph();
}

function graph(val) {
  if (val >= 0) {
    selected.push(ingredients[val]);
    quantities.push(1);
  }
  var i;
  document.getElementById("ingredient-table").innerHTML = "";
  for (i=0; i<selected.length; i++) {
    document.getElementById("ingredient-table").innerHTML += "<th>Ingredient</th><th>Servings</th><th>Quantitiy</th><tr><td>" + selected[i] + "</td><td><input id='servings-" + i + "'type='number' value=" + quantities[i] + " onchange='servings(" + i + ")'></input></td><td><input type='number' value=15></input> oz</td><td><button onclick='removeSlot(" + i + ")'>X</button></td><tr>";
  }
  

  
  if (val == 0) {
    calories.push(387 * quantities[0]);
    fat.push(0.3 * quantities[0]);
    sodium.push(1633 * quantities[0]);
    fiber.push(29 * quantities[0]);
    sugar.push(0 * quantities[0]);
    vitd.push(0 * quantities[0]);
    calcium.push(149 * quantities[0]);
    iron.push(8.1 * quantities[0]);
    potassium.push(1309.8 * quantities[0]);
  } 
  
  var caloriesSum = 0;
  var j = 0;
  for (j=0; j<calories.length; j++) {
    caloriesSum += calories[j];
    nutritionInfo[0] += fat[j];
    nutritionInfo[1] += sodium[j];
    nutritionInfo[2] += fiber[j];
    nutritionInfo[3] += sugar[j];
    nutritionInfo[4] += vitd[j];
    nutritionInfo[5] += calcium[j];
    nutritionInfo[6] += iron[j];
    nutritionInfo[7] += potassium[j];
  }
    
  //g, mg, g, g, mcg, mg, mg, mg
    
    document.getElementById("nutrition-table").innerHTML = "<th></th><th>Saturated Fat</th><th>Sodium</th><th>Dietary Fiber</th><th>Added Sugar</th><th>Vitamin D</th><th>Calcium</th><th>Iron</th><th>Potassium</th><tr>";
    for (i=0; i<selected.length; i++) {
      document.getElementById("nutrition-table").innerHTML += "<td>" + selected[i] + "<td>" + fat[i] + " g</td><td>" + sodium[i] + " mg</td><td>" + fiber[i] + " g</td><td>" + sugar[i] + " g</td><td>" + vitd[i] + " mcg</td><td>" + calcium[i] + " mg</td><td>" + iron[i] + " mg</td><td>" + potassium[i] + " mg</td><tr>";
    }
    document.getElementById("nutrition-table").innerHTML +="<td></td><td id='total'>" + nutritionInfo[0] + " g</td><td id='total'>" + nutritionInfo[1] + " mg</td><td id='total'>" + nutritionInfo[2] + " g</td><td id='total'>" + nutritionInfo[3] + " g</td><td id='total'>" + nutritionInfo[4] + " mcg</td><td id='total'>" + nutritionInfo[5] + " mg</td><td id='total'>" + nutritionInfo[6] + " mg</td><td id='total'>" + nutritionInfo[7] + " mg</td>"

  
  
  document.getElementById("calories").innerHTML = "Total calories: " + caloriesSum;
  var chart = new CanvasJS.Chart("chartContainer", {
    animationEnabled: true,
    title:{
      text: "Nutrition"
    },
    axisY: {
      title: "Percentage"
    },
    data: [{        
      type: "column",  
      showInLegend: true, 
      legendMarkerColor: "grey",
      legendText: "Percentage",
      dataPoints: [      
        { y: nutritionInfo[0] / dailyRec[0] * 100, label: "Saturated Fat" },
        { y: nutritionInfo[1] / dailyRec[1] * 100, label: "Sodium" },
        { y: nutritionInfo[2] / dailyRec[2] * 100, label: "Dietary Fiber" },
        { y: nutritionInfo[3] / dailyRec[3] * 100, label: "Added Sugars" },
        { y: nutritionInfo[4] / dailyRec[4] * 100, label: "Vitamin D" },
        { y: nutritionInfo[5] / dailyRec[5] * 100, label: "Calcium" },
        { y: nutritionInfo[6] / dailyRec[6] * 100, label: "Iron" },
        { y: nutritionInfo[7] / dailyRec[7] * 100, label: "Potassium" }
      ]
    }]
  });
  chart.render();
}

function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function filterFunction() {
  const input = document.getElementById("myInput");
  const filter = input.value.toUpperCase();
  const div = document.getElementById("myDropdown");
  const a = div.getElementsByTagName("a");
  for (let i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}
</script>
</head>


<style>

#total {
  font-weight: bold;
  border-top: 1px solid black;
}

.dropbtn {
  background-color: #04AA6D;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropbtn:hover, .dropbtn:focus {
  background-color: #3e8e41;
}

/* The search field */
#myInput {
  box-sizing: border-box;
  background-image: url('searchicon.png');
  background-position: 14px 12px;
  background-repeat: no-repeat;
  font-size: 16px;
  padding: 14px 20px 12px 45px;
  border: none;
  border-bottom: 1px solid #ddd;
}

/* The search field when it gets focus/clicked on */
#myInput:focus {outline: 3px solid #ddd;}

/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f6f6f6;
  min-width: 230px;
  border: 1px solid #ddd;
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}


.dropdown-content a:hover {background-color: #f1f1f1}

/* Show the dropdown menu (use JS to add this class to the .dropdown-content container when the user clicks on the dropdown button) */
.show {display:block;}
</style>
</html>
