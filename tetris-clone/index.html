<html>
<head>
  <meta charset="utf-8">
<!--  <link rel="stylesheet" href="style.css"> -->
  <title>Tetris</title>
</head>
<body>
<div id="content">
  <div id="board">
    <table>
      <td id="0-0"></td>
      <td id="0-1"></td>
      <td id="0-2"></td>
      <td id="0-3"></td>
      <td id="0-4"></td>
      <td id="0-5"></td>
      <td id="0-6"></td>
      <td id="0-7"></td>
      <td id="0-8"></td>
      <td id="0-9"></td>
      <tr></tr>
      <td id="1-0"></td>
      <td id="1-1"></td>
      <td id="1-2"></td>
      <td id="1-3"></td>
      <td id="1-4"></td>
      <td id="1-5"></td>
      <td id="1-6"></td>
      <td id="1-7"></td>
      <td id="1-8"></td>
      <td id="1-9"></td>
      <tr></tr>
      <td id="2-0"></td>
      <td id="2-1"></td>
      <td id="2-2"></td>
      <td id="2-3"></td>
      <td id="2-4"></td>
      <td id="2-5"></td>
      <td id="2-6"></td>
      <td id="2-7"></td>
      <td id="2-8"></td>
      <td id="2-9"></td>
      <tr></tr>
      <td id="3-0"></td>
      <td id="3-1"></td>
      <td id="3-2"></td>
      <td id="3-3"></td>
      <td id="3-4"></td>
      <td id="3-5"></td>
      <td id="3-6"></td>
      <td id="3-7"></td>
      <td id="3-8"></td>
      <td id="3-9"></td>
      <tr></tr>
      <td id="4-0"></td>
      <td id="4-1"></td>
      <td id="4-2"></td>
      <td id="4-3"></td>
      <td id="4-4"></td>
      <td id="4-5"></td>
      <td id="4-6"></td>
      <td id="4-7"></td>
      <td id="4-8"></td>
      <td id="4-9"></td>
      <tr></tr>
      <td id="5-0"></td>
      <td id="5-1"></td>
      <td id="5-2"></td>
      <td id="5-3"></td>
      <td id="5-4"></td>
      <td id="5-5"></td>
      <td id="5-6"></td>
      <td id="5-7"></td>
      <td id="5-8"></td>
      <td id="5-9"></td>
      <tr></tr>
      <td id="6-0"></td>
      <td id="6-1"></td>
      <td id="6-2"></td>
      <td id="6-3"></td>
      <td id="6-4"></td>
      <td id="6-5"></td>
      <td id="6-6"></td>
      <td id="6-7"></td>
      <td id="6-8"></td>
      <td id="6-9"></td>
      <tr></tr>
      <td id="7-0"></td>
      <td id="7-1"></td>
      <td id="7-2"></td>
      <td id="7-3"></td>
      <td id="7-4"></td>
      <td id="7-5"></td>
      <td id="7-6"></td>
      <td id="7-7"></td>
      <td id="7-8"></td>
      <td id="7-9"></td>
      <tr></tr>
      <td id="8-0"></td>
      <td id="8-1"></td>
      <td id="8-2"></td>
      <td id="8-3"></td>
      <td id="8-4"></td>
      <td id="8-5"></td>
      <td id="8-6"></td>
      <td id="8-7"></td>
      <td id="8-8"></td>
      <td id="8-9"></td>
      <tr></tr>
      <td id="9-0"></td>
      <td id="9-1"></td>
      <td id="9-2"></td>
      <td id="9-3"></td>
      <td id="9-4"></td>
      <td id="9-5"></td>
      <td id="9-6"></td>
      <td id="9-7"></td>
      <td id="9-8"></td>
      <td id="9-9"></td>
      <tr></tr>
      <td id="10-0"></td>
      <td id="10-1"></td>
      <td id="10-2"></td>
      <td id="10-3"></td>
      <td id="10-4"></td>
      <td id="10-5"></td>
      <td id="10-6"></td>
      <td id="10-7"></td>
      <td id="10-8"></td>
      <td id="10-9"></td>
      <tr></tr>
      <td id="11-0"></td>
      <td id="11-1"></td>
      <td id="11-2"></td>
      <td id="11-3"></td>
      <td id="11-4"></td>
      <td id="11-5"></td>
      <td id="11-6"></td>
      <td id="11-7"></td>
      <td id="11-8"></td>
      <td id="11-9"></td>
      <tr></tr>
      <td id="12-0"></td>
      <td id="12-1"></td>
      <td id="12-2"></td>
      <td id="12-3"></td>
      <td id="12-4"></td>
      <td id="12-5"></td>
      <td id="12-6"></td>
      <td id="12-7"></td>
      <td id="12-8"></td>
      <td id="12-9"></td>
      <tr></tr>
      <td id="13-0"></td>
      <td id="13-1"></td>
      <td id="13-2"></td>
      <td id="13-3"></td>
      <td id="13-4"></td>
      <td id="13-5"></td>
      <td id="13-6"></td>
      <td id="13-7"></td>
      <td id="13-8"></td>
      <td id="13-9"></td>
      <tr></tr>
      <td id="14-0"></td>
      <td id="14-1"></td>
      <td id="14-2"></td>
      <td id="14-3"></td>
      <td id="14-4"></td>
      <td id="14-5"></td>
      <td id="14-6"></td>
      <td id="14-7"></td>
      <td id="14-8"></td>
      <td id="14-9"></td>
      <tr></tr>
      <td id="15-0"></td>
      <td id="15-1"></td>
      <td id="15-2"></td>
      <td id="15-3"></td>
      <td id="15-4"></td>
      <td id="15-5"></td>
      <td id="15-6"></td>
      <td id="15-7"></td>
      <td id="15-8"></td>
      <td id="15-9"></td>
      <tr></tr>
      <td id="16-0"></td>
      <td id="16-1"></td>
      <td id="16-2"></td>
      <td id="16-3"></td>
      <td id="16-4"></td>
      <td id="16-5"></td>
      <td id="16-6"></td>
      <td id="16-7"></td>
      <td id="16-8"></td>
      <td id="16-9"></td>
      <tr></tr>
      <td id="17-0"></td>
      <td id="17-1"></td>
      <td id="17-2"></td>
      <td id="17-3"></td>
      <td id="17-4"></td>
      <td id="17-5"></td>
      <td id="17-6"></td>
      <td id="17-7"></td>
      <td id="17-8"></td>
      <td id="17-9"></td>
      <tr></tr>
      <td id="18-0"></td>
      <td id="18-1"></td>
      <td id="18-2"></td>
      <td id="18-3"></td>
      <td id="18-4"></td>
      <td id="18-5"></td>
      <td id="18-6"></td>
      <td id="18-7"></td>
      <td id="18-8"></td>
      <td id="18-9"></td>
      <tr></tr>
      <td id="19-0"></td>
      <td id="19-1"></td>
      <td id="19-2"></td>
      <td id="19-3"></td>
      <td id="19-4"></td>
      <td id="19-5"></td>
      <td id="19-6"></td>
      <td id="19-7"></td>
      <td id="19-8"></td>
      <td id="19-9"></td>
      <tr></tr>
    </table>
  </div>

  <div id="queue">
    <table>
      <td id="q0-0-0"></td>
      <td id="q0-0-1"></td>
      <td id="q0-0-2"></td>
      <td id="q0-0-3"></td>
      <tr></tr>
      <td id="q0-1-0"></td>
      <td id="q0-1-1"></td>
      <td id="q0-1-2"></td>
      <td id="q0-1-3"></td>
      <tr></tr>
      <td id="q0-2-0"></td>
      <td id="q0-2-1"></td>
      <td id="q0-2-2"></td>
      <td id="q0-2-3"></td>
      <tr></tr>
      <td id="q0-3-0"></td>
      <td id="q0-3-1"></td>
      <td id="q0-3-2"></td>
      <td id="q0-3-3"></td>
      <tr></tr>

      <td id="q1-0-0"></td>
      <td id="q1-0-1"></td>
      <td id="q1-0-2"></td>
      <td id="q1-0-3"></td>
      <tr></tr>
      <td id="q1-1-0"></td>
      <td id="q1-1-1"></td>
      <td id="q1-1-2"></td>
      <td id="q1-1-3"></td>
      <tr></tr>
      <td id="q1-2-0"></td>
      <td id="q1-2-1"></td>
      <td id="q1-2-2"></td>
      <td id="q1-2-3"></td>
      <tr></tr>
      <td id="q1-3-0"></td>
      <td id="q1-3-1"></td>
      <td id="q1-3-2"></td>
      <td id="q1-3-3"></td>
      <tr></tr>

      <td id="q2-0-0"></td>
      <td id="q2-0-1"></td>
      <td id="q2-0-2"></td>
      <td id="q2-0-3"></td>
      <tr></tr>
      <td id="q2-1-0"></td>
      <td id="q2-1-1"></td>
      <td id="q2-1-2"></td>
      <td id="q2-1-3"></td>
      <tr></tr>
      <td id="q2-2-0"></td>
      <td id="q2-2-1"></td>
      <td id="q2-2-2"></td>
      <td id="q2-2-3"></td>
      <tr></tr>
      <td id="q2-3-0"></td>
      <td id="q2-3-1"></td>
      <td id="q2-3-2"></td>
      <td id="q2-3-3"></td>
      <tr></tr>

      <td id="q3-0-0"></td>
      <td id="q3-0-1"></td>
      <td id="q3-0-2"></td>
      <td id="q3-0-3"></td>
      <tr></tr>
      <td id="q3-1-0"></td>
      <td id="q3-1-1"></td>
      <td id="q3-1-2"></td>
      <td id="q3-1-3"></td>
      <tr></tr>
      <td id="q3-2-0"></td>
      <td id="q3-2-1"></td>
      <td id="q3-2-2"></td>
      <td id="q3-2-3"></td>
      <tr></tr>
      <td id="q3-3-0"></td>
      <td id="q3-3-1"></td>
      <td id="q3-3-2"></td>
      <td id="q3-3-3"></td>
      <tr></tr>

      <td id="q4-0-0"></td>
      <td id="q4-0-1"></td>
      <td id="q4-0-2"></td>
      <td id="q4-0-3"></td>
      <tr></tr>
      <td id="q4-1-0"></td>
      <td id="q4-1-1"></td>
      <td id="q4-1-2"></td>
      <td id="q4-1-3"></td>
      <tr></tr>
      <td id="q4-2-0"></td>
      <td id="q4-2-1"></td>
      <td id="q4-2-2"></td>
      <td id="q4-2-3"></td>
      <tr></tr>
      <td id="q4-3-0"></td>
      <td id="q4-3-1"></td>
      <td id="q4-3-2"></td>
      <td id="q4-3-3"></td>
      <tr></tr>

      <td id="q5-0-0"></td>
      <td id="q5-0-1"></td>
      <td id="q5-0-2"></td>
      <td id="q5-0-3"></td>
      <tr></tr>
      <td id="q5-1-0"></td>
      <td id="q5-1-1"></td>
      <td id="q5-1-2"></td>
      <td id="q5-1-3"></td>
      <tr></tr>
      <td id="q5-2-0"></td>
      <td id="q5-2-1"></td>
      <td id="q5-2-2"></td>
      <td id="q5-2-3"></td>
      <tr></tr>
      <td id="q5-3-0"></td>
      <td id="q5-3-1"></td>
      <td id="q5-3-2"></td>
      <td id="q5-3-3"></td>
    </table>
  </div>

  <button id="btn-start" onClick="start()">Start</button>
  <div id="buttons">
    <button id="rotate" onClick="rotate(1)">⤵</button>
    <button id="move" onClick="move(0)">◄</button>
    <button id="move" onClick="move(1)">►</button>
    <button id="rotate" onClick="rotate(0)">⤴</button>
  </div>
  <span id="demo"></span>
</div>


<script>

var boardHeight = 20;
var boardWidth = 10;
var activeCell = [-3,3];

class block {
  constructor(name, body, color) {
    this.name = name;
    this.body = body;
    this.color = color;

    this.canDrop = true;
  }
}

var squareBlock = new block("Square Block", [[1,1],[1,2],[2,1],[2,2]], "yellow");
var sBlock = new block("S Block", [[2,0],[2,1],[1,1],[1,2]], "green");
var zBlock = new block("Z Block", [[2,2],[2,1],[1,1],[1,0]], "red");
var lBlock = new block("L Block", [[1,2],[2,2],[2,1],[2,0]], "orange");
var jBlock = new block("J Block", [[1,0],[2,0],[2,1],[2,2]], "blue");
var tBlock = new block("T Block", [[2,1],[1,1],[1,2],[1,0]], "purple");
var lineBlock = new block("Line Block", [[1,3],[1,2],[1,1],[1,0]], "cyan");

var queue = [squareBlock, sBlock, zBlock, lineBlock, jBlock, tBlock];
var reserveBlocks = [squareBlock, sBlock, zBlock, lBlock, jBlock, tBlock, lineBlock];
queue = shuffle(queue);

var activeBlock = reserveBlocks[0];

function start() {
  document.getElementById("btn-start").style.display = "none";
  setInterval(function(){
    nextTurn();
  }, 100);
}

function updateTable() {
  var i, j, k;
  for (i=0;i<boardWidth;i++) {
    for (j=0;j<boardHeight;j++) {
      document.getElementById(j + '-' + i).style.backgroundColor = "white";
    }
  }
  //color cells for active block
  for (k=0;k<activeBlock.body.length;k++) {
    if (activeCell[0]+activeBlock.body[k][0] < boardHeight && activeCell[1]+activeBlock.body[k][1] < boardWidth) {
      document.getElementById( (activeCell[0]+activeBlock.body[k][0]) + '-' + (activeCell[1]+activeBlock.body[k][1])).style.backgroundColor = activeBlock.color;
      document.getElementById( (activeCell[0]+activeBlock.body[k][0]) + '-' + (activeCell[1]+activeBlock.body[k][1])).style.border = "solid black 1px";
    }

  // color cells for placed blocks

  }
  // debug
  document.getElementById("demo").innerHTML = "<br>Active Cell: " + activeCell + "<br> Active Block: " + activeBlock.name;
}


updateQueue();


function updateQueue() {
  clearQueue();
  var i, j, k, l;
  for (i=0;i<queue.length;i++) {
    for(j=0;j<4;j++) {
      for(k=0;k<4;k++) {
        for(l=0;l<queue[i].body.length;l++) {
          document.getElementById("q"+i+"-"+queue[i].body[l][0] + "-"+queue[i].body[l][1]).style.backgroundColor = queue[i].color;
          document.getElementById("q"+i+"-"+queue[i].body[l][0] + "-"+queue[i].body[l][1]).style.border = "solid black 1px";
        }
      }
    }
  }
}

function clearQueue() {
  var i, j, k;
  for (i=0;i<queue.length;i++) {
    for(j=0;j<4;j++) {
      for(k=0;k<4;k++) {
        document.getElementById("q"+i+"-"+j+ "-"+k).style.backgroundColor = "white";
        document.getElementById("q"+i+"-"+j+ "-"+k).style.border = "none";
      }
    }
  }
}

function shuffle(array) {
  let currentIndex = array.length,  randomIndex;

  // While there remain elements to shuffle.
  while (currentIndex != 0) {

    // Pick a remaining element.
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    // And swap it with the current element.
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }

  return array;
}

function nextTurn() {
  var i;
  var drop = 0;

  for (i=0;i<activeBlock.body.length;i++) {
    if (activeCell[0]+activeBlock.body[i][0] >= boardHeight - 1) {
      drop++;
    }
  }

  if (drop != 0) {
    activeBlock.canDrop = false;
    cementBlock();
    dropNextBlock();
  } else {
    activeBlock.canDrop = true;
  }

  if (activeBlock.canDrop) {
    activeCell[0]++;
  }
  updateTable();
}

function cementBlock() {
  var body = [Number(activeBlock.body[0]) + Number(activeCell[0]), Number(activeBlock[1]) + activeCell[1]];
  activeBlock.body
}

function dropNextBlock() {
  activeBlock = queue.shift();
  reserveBlocks = shuffle(reserveBlocks);
  while (reserveBlocks[0] == queue[5]) {
    reserveBlocks = shuffle(reserveBlocks);
  }
  queue.push(reserveBlocks[0]);
  updateQueue();
  activeCell = [-3,3];
}

function move(direction) {
  var canMove = 0;
  var i;

  if (direction == 0) {
    // check entire body of block to ensure no part can go outside the board
    for (i=0;i<activeBlock.body.length;i++) {
      if (activeCell[1] + activeBlock.body[i][1] > 0) {
      } else {
        canMove++;
        break;
      }
    }
    if (canMove == 0) {
      activeCell[1]--;
    }
  } else if (direction == 1) {
    // check entire body of block to ensure no part can go outside the board
    for (i=0;i<activeBlock.body.length;i++) {
      if (activeCell[1] + activeBlock.body[i][1] < boardWidth - 1) {
      } else {
        canMove++;
        break;
      }
    }
    if (canMove == 0) {
      activeCell[1]++;
    }
  }

  updateTable();
}

function rotate(direction) {

}

function isOccupied(y, x) {
  if (document.getElementById(y + "-" + x).style.backgroundColor == "white" ) {
      return false;
  } else {
    return true;
  }
}
</script>

<style>
  body {
    background-color: black;
    color: green;
  }

  #content {
    margin: auto;
    display: block;
    width: 60%;
  }

  table {
    border-collapse: collapse;
    border: solid 2px white;
  }

  #board td {
    width: 24px;
    height: 24px;
    border: solid gray 1px;
    background-color: white;
  }


  #queue td {
    width: 16px;
    height: 16px;
    background-color: white;
  }

  #queue {
    position: fixed;
    right: 5%;
    top: 20px;
  }

  #rotate {
    width: 42px;
    height: 42px;
  }

  #move {
    width: 78px;
    height: 64px;
  }

</style>

</body>
</html>
